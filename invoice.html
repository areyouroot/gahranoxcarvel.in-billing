<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GC Labs Invoice Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            padding: 30px;
            text-align: center;
            color: white;
            border-radius: 15px;
            margin-bottom: 20px;
        }
        
        .watermark {
            position: fixed;
            bottom: 10px;
            left: 0;
            right: 0;
            text-align: center;
            color: #666;
            font-size: 12px;
            opacity: 0.7;
        }

        .qr-code {
            position: fixed;
            bottom: 40px;
            right: 20px;
            width: 100px;
            height: 100px;
        }

        /* Add all previous CSS styles here */
        
        @media print {
            .watermark {
                position: fixed;
                bottom: 10px;
                opacity: 0.5;
            }
            .qr-code {
                position: fixed;
                bottom: 40px;
                right: 20px;
                width: 100px;
                height: 100px;
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚ú® Professional Invoice Generator</h1>
            <p>Create beautiful, GST-compliant invoices in seconds</p>
        </div>

        <div class="form-section">
            <div>
                <h3 style="margin-bottom: 20px; color: #2c3e50;">Company Details</h3>
                <div class="form-group">
                    <label for="companyName">Company Name</label>
                    <input type="text" id="companyName" placeholder="Your Company Name">
                </div>
                <div class="form-group">
                    <label for="companyAddress">Company Address</label>
                    <textarea id="companyAddress" rows="3" placeholder="Complete address"></textarea>
                </div>
                <div class="form-group">
                    <label for="companyGST">GST Number</label>
                    <input type="text" id="companyGST" placeholder="22AAAAA0000A1Z5">
                </div>
                <div class="form-group">
                    <label for="companyPhone">Phone</label>
                    <input type="text" id="companyPhone" placeholder="+91 9876543210">
                </div>
                <div class="form-group">
                    <label for="companyEmail">Email</label>
                    <input type="email" id="companyEmail" placeholder="company@example.com">
                </div>
            </div>

            <div>
                <h3 style="margin-bottom: 20px; color: #2c3e50;">Customer Details</h3>
                <div class="form-group">
                    <label for="customerName">Customer Name</label>
                    <input type="text" id="customerName" placeholder="Customer Name">
                </div>
                <div class="form-group">
                    <label for="customerAddress">Customer Address</label>
                    <textarea id="customerAddress" rows="3" placeholder="Customer address"></textarea>
                </div>
                <div class="form-group">
                    <label for="customerGST">Customer GST (if applicable)</label>
                    <input type="text" id="customerGST" placeholder="Optional">
                </div>
                <div class="form-group">
                    <label for="invoiceNumber">Invoice Number</label>
                    <input type="text" id="invoiceNumber" placeholder="INV-001">
                </div>
                <div class="form-group">
                    <label for="invoiceDate">Invoice Date</label>
                    <input type="date" id="invoiceDate">
                </div>
            </div>

            <div class="logo-upload" onclick="document.getElementById('logoInput').click()">
                <input type="file" id="logoInput" accept="image/*" style="display: none;">
                <div>üìé Click to upload company logo</div>
                <img id="logoPreview" class="logo-preview" style="display: none;">
            </div>
        </div>

        <div class="products-section">
            <div class="products-header">
                <h3>Products / Services</h3>
                <button class="add-product-btn" onclick="addProduct()">+ Add Product</button>
            </div>
            <div id="productsContainer"></div>
        </div>

        <div id="additionalFeesContainer" class="products-section">
            <div class="products-header">
                <h3>Additional Fees</h3>
                <button class="add-product-btn" onclick="addAdditionalFee()">+ Add Fee</button>
            </div>
        </div>

        <div class="generate-section">
            <button class="generate-btn" onclick="generateInvoice()">üöÄ Generate Invoice</button>
        </div>

        <div class="invoice-preview" id="invoicePreview">
            <!-- Invoice will be generated here -->
        </div>

        <div id="watermark" class="watermark">
            Generated by Gahranox Carvel Labs Technologies Billing Software
        </div>
    </div>

    <script>
        let productCount = 0;
        let logoDataUrl = '';

        // Function to calculate subtotal
        function calculateSubtotal() {
            let subtotal = 0;
            document.querySelectorAll('.product-item').forEach(item => {
                const qty = parseFloat(item.querySelector('.product-qty')?.value) || 0;
                const rate = parseFloat(item.querySelector('.product-rate')?.value) || 0;
                subtotal += qty * rate;
            });
            return subtotal;
        }

        // Function to add a new product
        function addProduct() {
            productCount++;
            const container = document.getElementById('productsContainer');
            const productDiv = document.createElement('div');
            productDiv.className = 'product-item';
            productDiv.innerHTML = `
                <div class="form-group">
                    <label>Product/Service Name</label>
                    <input type="text" class="product-name" placeholder="Product name">
                </div>
                <div class="form-group">
                    <label>Quantity</label>
                    <input type="number" class="product-qty" value="1" min="1" onchange="calculateProductTotal(this)">
                </div>
                <div class="form-group">
                    <label>Rate (‚Çπ)</label>
                    <input type="number" class="product-rate" value="0" step="0.01" onchange="calculateProductTotal(this)">
                </div>
                <div class="form-group">
                    <label>GST (%)</label>
                    <select class="product-gst" onchange="calculateProductTotal(this)">
                        <option value="0">0%</option>
                        <option value="5">5%</option>
                        <option value="12">12%</option>
                        <option value="18" selected>18%</option>
                        <option value="28">28%</option>
                    </select>
                </div>
                <button class="remove-product" onclick="removeProduct(this)">√ó</button>
            `;
            container.appendChild(productDiv);
        }

        // Initialize with default logo
        window.onload = function() {
            // Set default logo using img tag
            const logoPreview = document.getElementById('logoPreview');
            logoPreview.src = 'DefaultLogo/GCCompanyLogo.png';
            logoPreview.style.display = 'block';
            
            // Set today's date
            document.getElementById('invoiceDate').value = new Date().toISOString().split('T')[0];
        };

        // Previous JavaScript functions remain the same

        function createInvoiceHTML(products) {
            const companyName = document.getElementById('companyName').value;
            const companyAddress = document.getElementById('companyAddress').value;
            const companyGST = document.getElementById('companyGST').value;
            const companyPhone = document.getElementById('companyPhone').value;
            const companyEmail = document.getElementById('companyEmail').value;
            
            const customerName = document.getElementById('customerName').value;
            const customerAddress = document.getElementById('customerAddress').value;
            const customerGST = document.getElementById('customerGST').value;
            const invoiceNumber = document.getElementById('invoiceNumber').value;
            const invoiceDate = document.getElementById('invoiceDate').value;
            
            const { totalFees, totalFeesGST } = calculateFees();
            
            let subtotal = 0;
            let totalGST = 0;
            let grandTotal = 0;
            
            const productRows = products.map((product, index) => {
                subtotal += product.subtotal;
                totalGST += product.gstAmount;
                grandTotal += product.total;
                
                return `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${product.name}</td>
                        <td>${product.qty}</td>
                        <td>‚Çπ${product.rate.toFixed(2)}</td>
                        <td>‚Çπ${product.subtotal.toFixed(2)}</td>
                        <td>${product.gst}%</td>
                        <td>‚Çπ${product.gstAmount.toFixed(2)}</td>
                        <td><strong>‚Çπ${product.total.toFixed(2)}</strong></td>
                    </tr>
                `;
            }).join('');

            // Add fees to grand total
            grandTotal += totalFees + totalFeesGST;
            
            const logoSection = document.getElementById('logoPreview').src;
            
            return `
                <div class="invoice-header">
                    <img src="${logoSection}" class="invoice-logo" alt="Company Logo">
                    <div class="invoice-title">
                        <h2>INVOICE</h2>
                        <p>No: ${invoiceNumber}</p>
                        <p>Date: ${new Date(invoiceDate).toLocaleDateString('en-IN')}</p>
                    </div>
                </div>
                
                <div class="invoice-body">
                    <div class="invoice-details">
                        <div class="company-details">
                            <h4>From:</h4>
                            <strong>${companyName}</strong><br>
                            ${companyAddress.replace(/\n/g, '<br>')}<br>
                            ${companyPhone ? `Phone: ${companyPhone}<br>` : ''}
                            ${companyEmail ? `Email: ${companyEmail}<br>` : ''}
                            ${companyGST ? `GST: ${companyGST}` : ''}
                        </div>
                        
                        <div class="customer-details">
                            <h4>To:</h4>
                            <strong>${customerName}</strong><br>
                            ${customerAddress.replace(/\n/g, '<br>')}<br>
                            ${customerGST ? `GST: ${customerGST}` : ''}
                        </div>
                    </div>
                    
                    <table class="invoice-table">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Product/Service</th>
                                <th>Qty</th>
                                <th>Rate</th>
                                <th>Amount</th>
                                <th>GST</th>
                                <th>GST Amt</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${productRows}
                        </tbody>
                    </table>
                    
                    <div class="totals-section">
                        <div class="total-row">
                            <span>Subtotal:</span>
                            <span>‚Çπ${subtotal.toFixed(2)}</span>
                        </div>
                        <div class="total-row">
                            <span>Additional Fees:</span>
                            <span>‚Çπ${totalFees.toFixed(2)}</span>
                        </div>
                        <div class="total-row">
                            <span>Total GST:</span>
                            <span>‚Çπ${(totalGST + totalFeesGST).toFixed(2)}</span>
                        </div>
                        <div class="total-row grand-total">
                            <span>Grand Total:</span>
                            <span>‚Çπ${grandTotal.toFixed(2)}</span>
                        </div>
                    </div>
                    
                    <div style="margin-top: 40px; text-align: center; color: #666;">
                        <p>Thank you for your business!</p>
                    </div>
                </div>
                
                <img src="DefaultLogo/GCCompanyQR.png" class="qr-code" alt="Visit our website">
                <div class="watermark">Generated by Gahranox Carvel Labs Technologies Billing Software</div>
                
                <button class="print-btn" onclick="window.print()">üñ®Ô∏è Print Invoice</button>
            `;
        }

        // Add additional fee functionality
        function addAdditionalFee() {
            const feesContainer = document.getElementById('additionalFeesContainer');
            const feeDiv = document.createElement('div');
            feeDiv.className = 'fee-item product-item';
            feeDiv.innerHTML = `
                <div class="form-group">
                    <label>Fee Name</label>
                    <input type="text" class="fee-name" placeholder="e.g., Processing Fee">
                </div>
                <div class="form-group">
                    <label>Fee Type</label>
                    <select class="fee-type" onchange="updateFeeInput(this)">
                        <option value="percentage">Percentage</option>
                        <option value="fixed">Fixed Amount</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Value</label>
                    <input type="number" class="fee-value" value="0" step="0.01" onchange="calculateFees()">
                </div>
                <div class="form-group">
                    <label>GST (%)</label>
                    <select class="fee-gst" onchange="calculateFees()">
                        <option value="0">0%</option>
                        <option value="5">5%</option>
                        <option value="12">12%</option>
                        <option value="18" selected>18%</option>
                        <option value="28">28%</option>
                    </select>
                </div>
                <button class="remove-product" onclick="removeFee(this)">√ó</button>
            `;
            feesContainer.appendChild(feeDiv);
        }

        function updateFeeInput(select) {
            const valueInput = select.parentElement.nextElementSibling.querySelector('.fee-value');
            if (select.value === 'percentage') {
                valueInput.step = '0.01';
                valueInput.placeholder = 'Enter percentage';
            } else {
                valueInput.step = '1';
                valueInput.placeholder = 'Enter amount';
            }
            calculateFees();
        }

        function removeFee(button) {
            button.parentElement.remove();
            calculateFees();
        }

        function calculateFees() {
            // Add fee calculation logic here
            // This will be called whenever fees are changed
            const subtotal = calculateSubtotal();
            const feeItems = document.querySelectorAll('.fee-item');
            let totalFees = 0;
            let totalFeesGST = 0;

            feeItems.forEach(item => {
                const type = item.querySelector('.fee-type').value;
                const value = parseFloat(item.querySelector('.fee-value').value) || 0;
                const gst = parseFloat(item.querySelector('.fee-gst').value) || 0;

                let feeAmount = 0;
                if (type === 'percentage') {
                    feeAmount = (subtotal * value) / 100;
                } else {
                    feeAmount = value;
                }

                const feeGST = (feeAmount * gst) / 100;
                totalFees += feeAmount;
                totalFeesGST += feeGST;
            });

            return { totalFees, totalFeesGST };
        }

        // Add first product by default
        addProduct();
    </script>
</body>
</html>